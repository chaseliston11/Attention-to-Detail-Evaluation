<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Attention to Detail & Comprehension Test</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    * {
      box-sizing: border-box;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      margin: 0;
      padding: 0;
      background: #f4f5f7;
      color: #222;
    }

    .container {
      max-width: 900px;
      margin: 40px auto;
      padding: 24px;
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.06);
    }

    h1, h2, h3 {
      margin-top: 0;
    }

    h1 {
      font-size: 1.8rem;
      margin-bottom: 0.5rem;
    }

    .subtitle {
      color: #555;
      margin-bottom: 1.5rem;
    }

    .section {
      display: none;
    }

    .section.active {
      display: block;
    }

    .btn-row {
      margin-top: 24px;
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }

    button {
      border: none;
      border-radius: 999px;
      padding: 10px 20px;
      cursor: pointer;
      font-size: 0.95rem;
      font-weight: 500;
      background: #111827;
      color: #fff;
      transition: background 0.2s ease, transform 0.1s ease;
    }

    button.secondary {
      background: #e5e7eb;
      color: #111827;
    }

    button:hover {
      background: #0b1120;
      transform: translateY(-1px);
    }

    button.secondary:hover {
      background: #d1d5db;
    }

    .pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      border-radius: 999px;
      background: #eef2ff;
      color: #3730a3;
      font-size: 0.8rem;
      margin-bottom: 10px;
    }

    .card {
      border-radius: 14px;
      background: #f9fafb;
      padding: 16px;
      margin: 12px 0;
      border: 1px solid #e5e7eb;
    }

    .question {
      margin: 14px 0;
    }

    .question p {
      margin: 0 0 6px 0;
    }

    label {
      display: block;
      margin: 4px 0;
      font-size: 0.95rem;
    }

    input[type="text"] {
      width: 100%;
      padding: 8px 10px;
      border-radius: 8px;
      border: 1px solid #d1d5db;
      font-size: 0.95rem;
    }

    .results-grid {
      display: grid;
      grid-template-columns: 2fr 1fr 1fr;
      gap: 8px;
      padding: 8px 0;
      border-bottom: 1px solid #e5e7eb;
      font-size: 0.9rem;
    }

    .results-grid.header {
      font-weight: 600;
      border-bottom: 2px solid #e5e7eb;
    }

    .badge-good {
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 0.75rem;
      background: #ecfdf3;
      color: #166534;
    }

    .badge-warn {
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 0.75rem;
      background: #fef3c7;
      color: #92400e;
    }

    .badge-bad {
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 0.75rem;
      background: #fef2f2;
      color: #b91c1c;
    }

    .small {
      font-size: 0.8rem;
      color: #6b7280;
    }

    ul {
      padding-left: 1.2rem;
    }

    .highlight {
      background: #fef3c7;
      padding: 2px 4px;
      border-radius: 4px;
    }

    .mono {
      font-family: "SF Mono", Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 0.85rem;
    }
  </style>
</head>
<body>
<div class="container">
  <!-- INTRO -->
  <div id="intro" class="section active">
    <h1>Attention to Detail &amp; Comprehension Assessment</h1>
    <p class="subtitle">
      This assessment measures how accurately and efficiently you handle detailed instructions, data, and written information.
      It is intentionally challenging, and a perfect score is rare.
    </p>

    <div class="card">
      <h3>How it works</h3>
      <ul>
        <li>The test has multiple sections. Each section is <strong>timed automatically</strong>.</li>
        <li>You will be scored on <strong>accuracy</strong> and <strong>speed</strong>.</li>
        <li>At the end, you’ll see:
          <ul>
            <li>Accuracy by section</li>
            <li>Your time vs. a benchmark “average” time</li>
            <li>Key improvement opportunities</li>
          </ul>
        </li>
      </ul>
      <p class="small">
        Tip: Go carefully, not just quickly. Many mistakes come from skimming or making assumptions.
      </p>
    </div>

    <div class="btn-row">
      <button id="startBtn">Start Assessment</button>
    </div>
  </div>

  <!-- SECTION 1: DATA DETAIL (BASELINE + MATCH/NO MATCH) -->
  <div id="section1" class="section">
    <span class="pill">Section 1 · Attention to Detail (Employee Record Match)</span>
    <h2>Compare Each Record to the Baseline</h2>
    <p>
      Below is a <strong>baseline employee record</strong>. Read it carefully. Then review the records beneath it.
      Some records match the baseline <strong>exactly</strong>, and others have one or more small differences
      (such as spacing, punctuation, digits, or spelling).
    </p>
    <p>
      Your task: <strong>Select every row that matches the baseline record exactly.</strong>
      If a row has <em>any</em> difference at all, leave it unchecked.
    </p>

    <div class="card mono">
      <p><strong>Baseline Record:</strong></p>
      <p>
        EMP-2047 · Name: Jonathan Smith · Dept: Finance · Phone: (555) 201-4488 · State: MN ·
        Email: jonathan.smith@example.com · Manager: Kelly Brown · Title: Financial Analyst ·
        Location: Minneapolis, MN · Status: Active · Hire Date: 06/14/2021 · Shift: Mon–Fri, 8:00–5:00
      </p>
    </div>

    <div class="card mono">
      <label>
        <input type="checkbox" name="s1" value="row1" />
        1. EMP-2047 · Name: Jonathan Smith · Dept: Finance · Phone: (555) 201-4488 · State: MN ·
           Email: jonathan.smith@example.com · Manager: Kelly Brown · Title: Financial Analyst ·
           Location: Minneapolis, MN · Status: Active · Hire Date: 06/14/2021 · Shift: Mon–Fri, 8:00–5:00
      </label>
      <label>
        <input type="checkbox" name="s1" value="row2" />
        2. EMP-2047 · Name: Jonathon Smith · Dept: Finance · Phone: (555) 201-4488 · State: MN ·
           Email: jonathan.smith@example.com · Manager: Kelly Brown · Title: Financial Analyst ·
           Location: Minneapolis, MN · Status: Active · Hire Date: 06/14/2021 · Shift: Mon–Fri, 8:00–5:00
      </label>
      <label>
        <input type="checkbox" name="s1" value="row3" />
        3. EMP-2047 · Name: Jonathan Smith · Dept: Finance · Phone: (555) 201-4488 · State: MN ·
           Email: jonathan.smith@example.com · Manager: Kelley Brown · Title: Financial Analyst ·
           Location: Minneapolis, MN · Status: Active · Hire Date: 06/14/2021 · Shift: Mon–Fri, 8:00–5:00
      </label>
      <label>
        <input type="checkbox" name="s1" value="row4" />
        4. EMP-2047 · Name: Jonathan Smith · Dept: Finance · Phone: (555) 201-4488 · State: MN ·
           Email: jonathan.smith@example.com · Manager: Kelly Brown · Title: Financial Analyst ·
           Location: Minneapolis, MN · Status: Active · Hire Date: 06/14/2021 · Shift: Mon–Fri, 8:00–5:00
      </label>
      <label>
        <input type="checkbox" name="s1" value="row5" />
        5. EMP-2047 · Name: Jonathan Smith · Dept: Finance · Phone: (555) 201-4488 · State: MN ·
           Email: jonathan.smith@example.co · Manager: Kelly Brown · Title: Financial Analyst ·
           Location: Minneapolis, MN · Status: Active · Hire Date: 06/14/2021 · Shift: Mon–Fri, 8:00–5:00
      </label>
    </div>

    <p class="small">
      Hint: Assume that even a single character difference (letter, digit, punctuation, or spacing) makes the record a mismatch.
    </p>

    <div class="btn-row">
      <button id="s1Next">Next Section</button>
    </div>
  </div>

  <!-- SECTION 2: READING + DETAIL (POLICY EMAIL, 3 QUESTIONS) -->
  <div id="section2" class="section">
    <span class="pill">Section 2 · Reading &amp; Detail (Policy Email)</span>
    <h2>Read Carefully, Then Answer from Memory</h2>
    <p>
      First, read the email below as many times as you like. When you are ready, click
      <strong>"Hide Text &amp; Begin Questions"</strong>. The text will disappear, and the timer will start.
      Most wrong answers are <strong>almost</strong> correct on purpose.
    </p>

    <div class="card" id="readingBlock">
      <p>
        On <span class="highlight">Monday, March 4th</span>, HR sent an email titled
        <span class="highlight">"Update: Remote Work &amp; Time Tracking"</span> to all
        <span class="highlight">full-time employees</span> in the
        <span class="highlight">Operations</span> and <span class="highlight">Sales</span> departments.
        The updated policy goes into effect on <span class="highlight">Monday, April 1st</span>.
      </p>
      <p>
        Starting on that date, employees must:
        (1) clock in no later than <span class="highlight">9:05 AM local time</span>;
        (2) submit their weekly timesheet by <span class="highlight">3:00 PM every Friday</span>;
        and (3) work on-site at least <span class="highlight">two days per week</span>,
        which must fall between <span class="highlight">Tuesday and Thursday</span>.
        <span class="highlight">Contractors and interns are excluded</span> from this update
        and should continue following their existing process.
      </p>
      <p>
        Questions should be sent to
        <span class="highlight">hr-operations@company.com</span> rather than to individual managers.
      </p>
    </div>

    <div class="btn-row" id="readingActions">
      <button id="hideReadingBtn">Hide Text &amp; Begin Questions</button>
    </div>

    <div id="readingQuestions" style="display:none;">
      <div class="card">
        <!-- Q1: Effective date -->
        <div class="question">
          <p>1. On what date does the updated policy go into effect?</p>
          <label><input type="radio" name="q1" value="date_march4" /> Monday, March 4th</label>
          <label><input type="radio" name="q1" value="date_april1" /> Monday, April 1st</label>
          <label><input type="radio" name="q1" value="date_april4" /> Thursday, April 4th</label>
          <label><input type="radio" name="q1" value="date_april1_noday" /> April 1st</label>
        </div>

        <!-- Q2: Who is excluded -->
        <div class="question">
          <p>2. Who is explicitly excluded from this policy update?</p>
          <label><input type="radio" name="q2" value="ex_contractors" /> Contractors only</label>
          <label><input type="radio" name="q2" value="ex_interns" /> Interns only</label>
          <label><input type="radio" name="q2" value="ex_contractors_interns" /> Contractors and interns</label>
          <label><input type="radio" name="q2" value="ex_parttime" /> All part-time employees</label>
        </div>

        <!-- Q3: Correct email address -->
        <div class="question">
          <p>3. Which email address should employees use for questions, according to the email?</p>
          <label><input type="radio" name="q3" value="email_hr_ops_dot" /> hr.operations@company.com</label>
          <label><input type="radio" name="q3" value="email_hr_ops_dash" /> hr-operations@company.com</label>
          <label><input type="radio" name="q3" value="email_hr_ops_co" /> hr-operations@company.co</label>
          <label><input type="radio" name="q3" value="email_hr_team" /> hr-team@company.com</label>
        </div>
      </div>

      <div class="btn-row">
        <button id="s2Next">Next Section</button>
      </div>
    </div>
  </div>

  <!-- SECTION 3: INSTRUCTION FOLLOWING -->
  <div id="section3" class="section">
    <span class="pill">Section 3 · Following Complex Instructions</span>
    <h2>Follow All Instructions Exactly</h2>
    <div class="card">
      <p><strong>Read all instructions before making any changes!</strong></p>
      <p>
        Once you have read everything below, follow these instructions exactly:
      </p>
      <ol>
        <li>In the text box labeled <strong>“Favorite color”</strong>, type your favorite color.</li>
        <li>After typing it, erase the entire content so the box is completely blank.</li>
        <li>Before erasing your favorite color, put 1 (one) space after your typed out color and then type your full name.</li>
        <li>Select exactly <span class="highlight">two</span> of the four checkboxes below.</li>
        <li>One of the boxes you select <strong>must be “C”</strong>, and you must <strong>not</strong> select box “A”.</li>
        <li>Once you are sure you have followed every instruction, click “Submit &amp; View Results”.</li>
      </ol>
      <p class="small">
        Many people skim and miss at least one detail in this section. Slow down and double-check your actions against the instructions.
      </p>
    </div>

    <div class="card">
      <div class="question">
        <p>Favorite color:</p>
        <input type="text" id="s3Color" placeholder="Follow the instructions above carefully" />
      </div>
      <div class="question">
        <p>Checkboxes:</p>
        <label><input type="checkbox" name="s3" value="A" /> A</label>
        <label><input type="checkbox" name="s3" value="B" /> B</label>
        <label><input type="checkbox" name="s3" value="C" /> C</label>
        <label><input type="checkbox" name="s3" value="D" /> D</label>
      </div>
    </div>

    <div class="btn-row">
      <button id="s3Next">Submit &amp; View Results</button>
    </div>
  </div>

  <!-- RESULTS -->
  <div id="results" class="section">
    <span class="pill">Results</span>
    <h2>Your Assessment Summary</h2>
    <p>
      Below is a breakdown of your performance by section. Scores are based on
      both <strong>accuracy</strong> and <strong>time</strong>, along with some behavioral details for Section 3.
    </p>

    <div class="card">
      <div class="results-grid header">
        <div>Section</div>
        <div>Accuracy</div>
        <div>Time vs. Benchmark</div>
      </div>
      <div class="results-grid">
        <div>Section 1 · Data Detail</div>
        <div id="s1Accuracy"></div>
        <div id="s1Time"></div>
      </div>
      <div class="results-grid">
        <div>Section 2 · Reading &amp; Detail</div>
        <div id="s2Accuracy"></div>
        <div id="s2Time"></div>
      </div>
      <div class="results-grid">
        <div>Section 3 · Instruction Following</div>
        <div id="s3Accuracy"></div>
        <div id="s3Time"></div>
      </div>
    </div>

    <div class="card">
      <h3>Interpretation &amp; Improvement Areas</h3>
      <p id="overallSummary"></p>
      <ul id="improvementList"></ul>
      <h4>Section 3 Behavioral Details</h4>
      <ul id="behaviorList"></ul>
      <p class="small">
        Note: Benchmarks are placeholders. For real usage with candidates/employees,
        you can replace these with your own averages based on collected data.
      </p>
    </div>

    <div class="btn-row">
      <button class="secondary" onclick="location.reload()">Restart Assessment</button>
    </div>
  </div>
</div>

<script>
  // ----- CONFIG: BENCHMARK TIMES (SECONDS) -----
  const BENCHMARKS = {
    section1: 90,   // 1.5 minutes
    section2: 90,   // 1.5 minutes (3 questions)
    section3: 90    // 1.5 minutes
  };

  const state = {
    currentSection: "intro",
    startTimes: {},
    durations: {},
    scores: {},
    section3Behavior: {
      colorEverNonEmpty: false,
      colorHadNameBeforeClear: false,
      colorWasCleared: false,
      checkboxEverChecked: false,
      checkboxUncheckedAfterCheck: false
    }
  };

  function showSection(id) {
    document.querySelectorAll(".section").forEach(sec => {
      sec.classList.remove("active");
    });
    const target = document.getElementById(id);
    if (target) {
      target.classList.add("active");
      state.currentSection = id;
    }
  }

  function startTimer(sectionId) {
    state.startTimes[sectionId] = performance.now();
  }

  function stopTimer(sectionId) {
    const start = state.startTimes[sectionId];
    if (!start) return;
    const end = performance.now();
    const seconds = (end - start) / 1000;
    state.durations[sectionId] = seconds;
  }

  function formatSeconds(sec) {
    return sec ? sec.toFixed(1) + "s" : "0.0s";
  }

  function badgeForTime(sec, benchmark) {
    if (!benchmark || !sec) return '<span class="small">No timing data</span>';

    if (sec <= benchmark * 0.8) {
      return `<span class="badge-good">Faster than average</span>`;
    } else if (sec <= benchmark * 1.2) {
      return `<span class="badge-warn">Around average</span>`;
    } else {
      return `<span class="badge-bad">Slower than average</span>`;
    }
  }

  function badgeForAccuracy(pct) {
    if (pct >= 90) {
      return `<span class="badge-good">${pct}%</span>`;
    } else if (pct >= 70) {
      return `<span class="badge-warn">${pct}%</span>`;
    } else {
      return `<span class="badge-bad">${pct}%</span>`;
    }
  }

  // SCORING: SECTION 1 (per-row, partial credit)
  function scoreSection1() {
    // Rows that exactly match the baseline: row1, row4
    const expected = {
      row1: true,   // should be checked
      row2: false,  // should NOT be checked
      row3: false,  // should NOT be checked
      row4: true,   // should be checked
      row5: false   // should NOT be checked
    };

    let correct = 0;
    const rowIds = Object.keys(expected);
    const total = rowIds.length; // 5 rows total

    rowIds.forEach(id => {
      const cb = document.querySelector(`input[name="s1"][value="${id}"]`);
      const isChecked = cb ? cb.checked : false;
      if (isChecked === expected[id]) {
        correct++;
      }
    });

    const accuracyPct = (correct / total) * 100;
    state.scores.section1 = { correct, total, accuracyPct };
  }

  // SCORING: SECTION 2 (3 MCQs)
  function scoreSection2() {
    const correctAnswers = {
      q1: "date_april1",             // Monday, April 1st
      q2: "ex_contractors_interns",  // Contractors and interns
      q3: "email_hr_ops_dash"        // hr-operations@company.com
    };

    const closeAnswers = {
      q1: ["date_april1_noday"],                 // Right date, missing weekday
      q2: ["ex_contractors", "ex_interns"],      // Half correct
      q3: ["email_hr_ops_dot", "email_hr_ops_co"]// Very close email
    };

    let correct = 0;
    const total = 3;
    let closeWrong = 0;

    for (let i = 1; i <= total; i++) {
      const name = `q${i}`;
      const chosen = document.querySelector(`input[name="${name}"]:checked`);
      if (!chosen) continue;
      const value = chosen.value;

      if (value === correctAnswers[name]) {
        correct++;
      } else if (closeAnswers[name] && closeAnswers[name].includes(value)) {
        closeWrong++;
      }
    }

    const accuracyPct = (correct / total) * 100;
    state.scores.section2 = { correct, total, accuracyPct, closeWrong };
  }

  // SCORING: SECTION 3
  function scoreSection3() {
    const colorValue = document.getElementById("s3Color").value.trim();
    const checkboxes = Array.from(document.querySelectorAll('input[name="s3"]:checked')).map(cb => cb.value);

    // 3 checks:
    // 1) Color + space + full name existed at some point, and the field was eventually cleared.
    // 2) Exactly two checkboxes selected.
    // 3) One of the boxes is C, and A is not selected.
    let total = 3;
    let correct = 0;

    const behavior = state.section3Behavior;
    const colorCondition =
      behavior.colorEverNonEmpty &&
      behavior.colorHadNameBeforeClear &&
      behavior.colorWasCleared &&
      colorValue === "";

    if (colorCondition) correct++;

    if (checkboxes.length === 2) correct++;

    const hasC = checkboxes.includes("C");
    const hasA = checkboxes.includes("A");
    if (hasC && !hasA) correct++;

    const accuracyPct = (correct / total) * 100;
    state.scores.section3 = { correct, total, accuracyPct };
  }

  function buildResults() {
    const s1 = state.scores.section1 || { accuracyPct: 0 };
    const s1TimeSec = state.durations.section1 || 0;
    document.getElementById("s1Accuracy").innerHTML = badgeForAccuracy(Math.round(s1.accuracyPct));
    document.getElementById("s1Time").innerHTML =
      `${formatSeconds(s1TimeSec)}<br/><span class="small">${badgeForTime(s1TimeSec, BENCHMARKS.section1)}</span>`;

    const s2 = state.scores.section2 || { accuracyPct: 0, closeWrong: 0 };
    const s2TimeSec = state.durations.section2 || 0;
    document.getElementById("s2Accuracy").innerHTML = badgeForAccuracy(Math.round(s2.accuracyPct));
    document.getElementById("s2Time").innerHTML =
      `${formatSeconds(s2TimeSec)}<br/><span class="small">${badgeForTime(s2TimeSec, BENCHMARKS.section2)}</span>`;

    const s3 = state.scores.section3 || { accuracyPct: 0 };
    const s3TimeSec = state.durations.section3 || 0;
    document.getElementById("s3Accuracy").innerHTML = badgeForAccuracy(Math.round(s3.accuracyPct));
    document.getElementById("s3Time").innerHTML =
      `${formatSeconds(s3TimeSec)}<br/><span class="small">${badgeForTime(s3TimeSec, BENCHMARKS.section3)}</span>`;

    const overallSummary = document.getElementById("overallSummary");
    const improvementList = document.getElementById("improvementList");
    const behaviorList = document.getElementById("behaviorList");
    improvementList.innerHTML = "";
    behaviorList.innerHTML = "";

    const avgAccuracy = (
      (s1.accuracyPct + s2.accuracyPct + s3.accuracyPct) / 3
    ).toFixed(1);

    overallSummary.textContent =
      `Your overall accuracy across all sections was ${avgAccuracy}%. `
      + `This assessment is designed to highlight diligence: carefully reading, cross-checking details, and following instructions exactly.`;

    // Targeted improvement tips
    if (s1.accuracyPct < 90) {
      const li = document.createElement("li");
      li.textContent =
        "Section 1 (Data Detail): Practice comparing records character-by-character. Even a single misplaced letter, digit, or punctuation mark changes the meaning.";
      improvementList.appendChild(li);
    }

    if (s2.accuracyPct < 90) {
      const li = document.createElement("li");
      li.textContent =
        "Section 2 (Reading & Detail): Focus on capturing exact requirements in written communication (dates, exclusions, and contact details). Small differences can change the entire instruction.";
      improvementList.appendChild(li);
    }

    if (s2.closeWrong && s2.closeWrong > 0) {
      const li = document.createElement("li");
      li.textContent =
        `Section 2: You had ${s2.closeWrong} answer(s) that were very close but still incorrect. This suggests you understood the general idea but missed a key word or detail.`;
      improvementList.appendChild(li);
    }

    if (s3.accuracyPct < 90) {
      const li = document.createElement("li");
      li.textContent =
        "Section 3 (Instructions): Before acting, read all steps in order and mentally check your actions against each point. This mirrors following complex process documentation.";
      improvementList.appendChild(li);
    }

    if (
      s1.accuracyPct >= 90 &&
      s2.accuracyPct >= 90 &&
      s3.accuracyPct >= 90
    ) {
      const li = document.createElement("li");
      li.textContent =
        "Strong performance across all sections. You demonstrate high diligence: careful reading, accurate detail handling, and precise instruction-following.";
      improvementList.appendChild(li);
    }

    // Section 3 behavioral details
    const b = state.section3Behavior;

    const li1 = document.createElement("li");
    li1.textContent = b.colorEverNonEmpty
      ? "Favorite color box: You entered a value at least once (as instructed)."
      : "Favorite color box: No value was ever entered, which does not follow the instruction to type your favorite color.";
    behaviorList.appendChild(li1);

    const li2 = document.createElement("li");
    li2.textContent = b.colorHadNameBeforeClear
      ? "Favorite color box: At some point, the field contained your color plus additional text (such as a name) before being cleared."
      : "Favorite color box: There is no indication that both your color and your full name were entered before clearing the field.";
    behaviorList.appendChild(li2);

    const li3 = document.createElement("li");
    li3.textContent = b.colorWasCleared
      ? "Favorite color box: The field was fully cleared at least once."
      : "Favorite color box: The field was never fully cleared to blank.";
    behaviorList.appendChild(li3);

    const li4 = document.createElement("li");
    li4.textContent = b.checkboxEverChecked
      ? "Checkboxes: At least one checkbox was selected at some point."
      : "Checkboxes: No checkbox was ever selected.";
    behaviorList.appendChild(li4);

    const li5 = document.createElement("li");
    li5.textContent = b.checkboxUncheckedAfterCheck
      ? "Checkboxes: All selected options were cleared at least once, indicating you changed your selections."
      : "Checkboxes: There is no indication that all selected checkboxes were cleared at any point.";
    behaviorList.appendChild(li5);
  }

  document.addEventListener("DOMContentLoaded", () => {
    // Intro -> Section1
    document.getElementById("startBtn").addEventListener("click", () => {
      showSection("section1");
      startTimer("section1");
    });

    // Section 1 -> Section 2
    document.getElementById("s1Next").addEventListener("click", () => {
      stopTimer("section1");
      scoreSection1();
      showSection("section2");
      // timer for section2 starts after reading is hidden
    });

    // Hide reading & show questions (start timer)
    document.getElementById("hideReadingBtn").addEventListener("click", () => {
      const block = document.getElementById("readingBlock");
      const actions = document.getElementById("readingActions");
      const questions = document.getElementById("readingQuestions");
      block.style.display = "none";
      actions.style.display = "none";
      questions.style.display = "block";
      startTimer("section2");
    });

    // Section 2 -> Section 3
    document.getElementById("s2Next").addEventListener("click", () => {
      stopTimer("section2");
      scoreSection2();
      showSection("section3");
      startTimer("section3");
    });

    // Track Section 3 favorite color behavior
    const colorInput = document.getElementById("s3Color");
    colorInput.addEventListener("input", () => {
      const val = colorInput.value;
      const b = state.section3Behavior;

      if (val.length > 0) {
        if (!b.colorEverNonEmpty) {
          b.colorEverNonEmpty = true;
        }
        // Check for "color + space + name" pattern (at least two non-empty chunks)
        const parts = val.split(" ").filter(p => p.trim().length > 0);
        if (parts.length >= 2) {
          b.colorHadNameBeforeClear = true;
        }
      } else {
        // Field cleared after having content
        if (b.colorEverNonEmpty) {
          b.colorWasCleared = true;
        }
      }
    });

    // Track Section 3 checkbox behavior
    const s3Checkboxes = document.querySelectorAll('input[name="s3"]');
    s3Checkboxes.forEach(cb => {
      cb.addEventListener("change", () => {
        const anyChecked = Array.from(document.querySelectorAll('input[name="s3"]'))
          .some(c => c.checked);
        const b = state.section3Behavior;

        if (anyChecked) {
          if (!b.checkboxEverChecked) {
            b.checkboxEverChecked = true;
          }
        } else {
          if (b.checkboxEverChecked) {
            b.checkboxUncheckedAfterCheck = true;
          }
        }
      });
    });

    // Section 3 -> Results
    document.getElementById("s3Next").addEventListener("click", () => {
      stopTimer("section3");
      scoreSection3();
      buildResults();
      showSection("results");
    });
  });
</script>
</body>
</html>
